{% extends "base.html" %} {% block title %}My Account - Fresh Mart{% endblock %}
{% block content %} {% if current_user.is_authenticated %}
<!-- Authenticated User View -->
<div class="bg-emerald-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <h1 class="text-4xl font-bold text-gray-900 mb-4">
      Welcome back, {{ current_user.name }}!
    </h1>
    <p class="text-lg text-gray-600">Manage your account and orders</p>
  </div>
</div>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
    <!-- Quick Stats -->
    <div class="bg-white rounded-lg shadow-sm p-6">
      <div class="text-center">
        <h3 class="text-lg font-medium text-gray-900 mb-2">Total Orders</h3>
        <p class="text-3xl font-bold text-emerald-600">{{ orders|length }}</p>
      </div>
    </div>
    <div class="bg-white rounded-lg shadow-sm p-6">
      <div class="text-center">
        <h3 class="text-lg font-medium text-gray-900 mb-2">Wishlist Items</h3>
        <p class="text-3xl font-bold text-emerald-600">{{ wishlist|length }}</p>
      </div>
    </div>
    <div class="bg-white rounded-lg shadow-sm p-6">
      <div class="text-center">
        <h3 class="text-lg font-medium text-gray-900 mb-2">Active Cart</h3>
        <p class="text-3xl font-bold text-emerald-600">
          {{ cart.items|length if cart else 0 }}
        </p>
      </div>
    </div>

    <!-- Recent Orders -->
    <div class="md:col-span-3">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">Recent Orders</h2>
      {% if orders %}
      <div class="bg-white rounded-lg shadow-sm overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Order ID
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Date
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Total
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Status
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Action
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for order in orders %}
            <tr>
              <td
                class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
              >
                #{{ order.id }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ order.created_at.strftime('%B %d, %Y') }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                ${{ "%.2f"|format(order.total_amount) }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {% if order.status == 'Delivered' %}bg-green-100 text-green-800 {% elif order.status == 'Processing' %}bg-yellow-100 text-yellow-800 {% else %}bg-blue-100 text-blue-800{% endif %}"
                >
                  {{ order.status }}
                </span>
              </td>
              <td
                class="px-6 py-4 whitespace-nowrap text-sm text-emerald-600 hover:text-emerald-900"
              >
                <a href="/orders/{{ order.id }}">View Details</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="bg-white rounded-lg shadow-sm p-6 text-center">
        <p class="text-gray-500">You haven't placed any orders yet.</p>
        <a
          href="{{ url_for('products') }}"
          class="mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-emerald-600 hover:bg-emerald-700"
        >
          Start Shopping
        </a>
      </div>
      {% endif %}
    </div>

    <!-- Wishlist -->
    <div class="md:col-span-3 mt-8">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900">My Wishlist</h2>
        <a
          href="{{ url_for('wishlist') }}"
          class="text-emerald-600 hover:text-emerald-700 font-medium flex items-center"
        >
          View All
          <svg
            class="ml-1 w-5 h-5"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
              clip-rule="evenodd"
            />
          </svg>
        </a>
      </div>

      {% if wishlist %}
      <div
        class="grid grid-cols-1 gap-y-10 gap-x-6 sm:grid-cols-2 lg:grid-cols-4"
      >
        {% for item in wishlist[:4] %}
        <div
          class="group relative bg-white rounded-lg shadow-sm overflow-hidden transition-all duration-300 hover:shadow-lg"
        >
          <div
            class="w-full h-48 bg-gray-200 aspect-w-1 aspect-h-1 overflow-hidden"
          >
            {% if item.product.image_url %}
            <img
              src="{{ url_for('static', filename=item.product.image_url) }}"
              alt="{{ item.product.name }}"
              class="w-full h-full object-center object-cover group-hover:opacity-75"
            />
            {% else %}
            <div
              class="w-full h-full flex items-center justify-center bg-gray-100"
            >
              <svg
                class="h-12 w-12 text-gray-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="1"
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                />
              </svg>
            </div>
            {% endif %}
          </div>
          <div class="p-4">
            <h3 class="text-sm font-medium text-gray-900">
              <a href="{{ url_for('product_details', id=item.product.id) }}">
                {{ item.product.name }}
              </a>
            </h3>
            <!-- Rating -->
            <div class="mt-1 flex items-center">
              <div class="flex items-center">
                {% for i in range(5) %} {% if i < item.product.avg_rating|int %}
                <svg
                  class="w-3 h-3 text-yellow-400"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                  ></path>
                </svg>
                {% else %}
                <svg
                  class="w-3 h-3 text-gray-300"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                  ></path>
                </svg>
                {% endif %} {% endfor %}
              </div>
              <p class="ml-1 text-xs text-gray-500">
                ({{ item.product.total_ratings }})
              </p>
            </div>
            <div class="mt-2 flex justify-between items-center">
              <div>
                <p class="text-lg font-bold text-gray-900">
                  â‚¹{{ "%.2f"|format(item.product.price) }}
                </p>
                {% if item.product.stock > 0 %}
                <p class="text-xs text-emerald-600">In Stock</p>
                {% else %}
                <p class="text-xs text-red-600">Out of Stock</p>
                {% endif %}
              </div>
              <div class="flex space-x-2">
                <form
                  action="{{ url_for('add_to_cart', product_id=item.product.id) }}"
                  method="POST"
                  class="inline"
                >
                  <input type="hidden" name="quantity" value="1" />
                  <button
                    type="submit"
                    class="p-1.5 text-emerald-600 hover:text-emerald-700 rounded-full hover:bg-emerald-50"
                    {%
                    if
                    item.product.stock
                    <="0"
                    %}disabled{%
                    endif
                    %}
                  >
                    <svg
                      class="w-5 h-5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"
                      ></path>
                    </svg>
                  </button>
                </form>
                <form
                  action="{{ url_for('remove_from_wishlist', item_id=item.id) }}"
                  method="POST"
                  class="inline"
                >
                  <button
                    type="submit"
                    class="p-1.5 text-red-500 hover:text-red-600 rounded-full hover:bg-red-50"
                  >
                    <svg
                      class="w-5 h-5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                      ></path>
                    </svg>
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="bg-white rounded-lg shadow-sm p-8 text-center">
        <svg
          class="mx-auto h-12 w-12 text-gray-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="1"
            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
          ></path>
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">
          Your wishlist is empty
        </h3>
        <p class="mt-1 text-sm text-gray-500">
          Add items to your wishlist to save them for later.
        </p>
        <div class="mt-6">
          <a
            href="{{ url_for('products') }}"
            class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500"
          >
            Browse Products
          </a>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Addresses -->
    <div class="md:col-span-3 mt-8">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900">My Addresses</h2>
        <a
          href="{{ url_for('view_addresses') }}"
          class="text-emerald-600 hover:text-emerald-700 font-medium flex items-center"
        >
          Manage Addresses
          <svg
            class="ml-1 w-5 h-5"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
              clip-rule="evenodd"
            />
          </svg>
        </a>
      </div>

      {% set addresses = current_user.addresses[:2] %} {% if addresses %}
      <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
        {% for address in addresses %}
        <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
          <div class="space-y-1 text-gray-700">
            <p>{{ address.line1 }}</p>
            {% if address.line2 %}
            <p>{{ address.line2 }}</p>
            {% endif %}
            <p>
              {{ address.city }}, {{ address.state }} {{ address.zip_code }}
            </p>
            <p>{{ address.country }}</p>
          </div>
        </div>
        {% endfor %}
      </div>
      {% if current_user.addresses|length > 2 %}
      <div class="mt-4 text-center">
        <a
          href="{{ url_for('view_addresses') }}"
          class="text-emerald-600 hover:text-emerald-700 font-medium"
        >
          View all {{ current_user.addresses|length }} addresses
        </a>
      </div>
      {% endif %} {% else %}
      <div class="bg-white rounded-lg shadow-sm p-6 text-center">
        <svg
          class="mx-auto h-12 w-12 text-gray-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="1"
            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
          ></path>
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">
          No addresses saved
        </h3>
        <p class="mt-1 text-sm text-gray-500">
          Add shipping addresses to make checkout faster.
        </p>
        <div class="mt-6">
          <a
            href="{{ url_for('add_address') }}"
            class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500"
          >
            <svg
              class="mr-2 h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 6v6m0 0v6m0-6h6m-6 0H6"
              ></path>
            </svg>
            Add New Address
          </a>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Account Settings -->
    <div class="md:col-span-3">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">Account Settings</h2>
      <div class="bg-white rounded-lg shadow-sm p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Personal Information -->
          <div>
            <h3 class="text-lg font-medium text-gray-900 mb-4">
              Personal Information
            </h3>
            <form
              class="space-y-4"
              action="{{ url_for('update_account') }}"
              method="POST"
            >
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Name</label
                >
                <input
                  type="text"
                  name="name"
                  value="{{ current_user.name }}"
                  required
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Email</label
                >
                <input
                  type="email"
                  name="email"
                  value="{{ current_user.email }}"
                  required
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Phone</label
                >
                <input
                  type="tel"
                  name="phone"
                  value="{{ current_user.phone }}"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm"
                />
              </div>

              <button
                type="submit"
                class="flex justify-center py-2.5 px-4 border border-emerald-600 rounded-lg shadow-sm text-sm font-medium text-emerald-600 bg-white hover:bg-emerald-700 hover:text-white hover:border-transparent focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500"
              >
                Update Information
              </button>
            </form>
          </div>

          <!-- Password Change -->
          <div>
            <h3 class="text-lg font-medium text-gray-900 mb-4">
              Change Password
            </h3>
            <form
              class="space-y-4"
              action="{{ url_for('change_password') }}"
              method="POST"
            >
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Current Password</label
                >
                <input
                  type="password"
                  name="current_password"
                  required
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >New Password</label
                >
                <input
                  type="password"
                  name="new_password"
                  required
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Confirm New Password</label
                >
                <input
                  type="password"
                  name="confirm_password"
                  required
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm"
                />
              </div>

              <button
                type="submit"
                class="flex justify-center py-2.5 px-4 border border-emerald-600 rounded-lg shadow-sm text-sm font-medium text-emerald-600 bg-white hover:bg-emerald-700 hover:text-white hover:border-transparent focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500"
              >
                Change Password
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% else %}
<!-- Non-Authenticated User View -->
<div class="min-h-[80vh] flex items-center justify-center bg-gray-50">
  <div class="max-w-md w-full mx-4">
    <div class="text-center mb-8">
      <h2 class="text-3xl font-extrabold text-gray-900">
        Welcome to Fresh Mart
      </h2>
      <p class="mt-2 text-lg text-gray-600">Sign in to access your account</p>
    </div>

    <div class="bg-white py-8 px-4 shadow-sm rounded-lg sm:px-10">
      <div class="space-y-6">
        <a
          href="{{ url_for('login') }}"
          class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500"
        >
          Login Now
        </a>
        <div class="relative">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-gray-300"></div>
          </div>
          <div class="relative flex justify-center text-sm">
            <span class="px-2 bg-white text-gray-500">Or</span>
          </div>
        </div>
        <a
          href="{{ url_for('register') }}"
          class="w-full flex justify-center py-2 px-4 border border-emerald-600 rounded-md shadow-sm text-sm font-medium text-emerald-600 bg-white hover:bg-emerald-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500"
        >
          Create New Account
        </a>
      </div>
    </div>
  </div>
</div>
{% endif %} {% endblock %}
